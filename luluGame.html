<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å™œå™œï¼šå¿ƒåŠ¨æ”¶é›†å¤§ä½œæˆ˜</title>
    <style>
        :root {
            --bg-color: #ffeef2;
            --primary-pink: #ff85a1;
            --accent-gold: #fcc419;
        }
        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            overflow: hidden; font-family: 'Microsoft YaHei', sans-serif;
            background: var(--bg-color); touch-action: none;
        }
        #game-container { position: relative; width: 100%; height: 100%; }
        canvas { display: block; }
        
        /* UI æ¶‚å±‚ */
        #ui-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
        }
        .score-box {
            position: absolute; top: 40px; width: 100%; text-align: center;
            font-size: 24px; font-weight: bold; color: #ff4757; text-shadow: 2px 2px white;
        }
        #message-popup {
            position: absolute; top: 45%; left: 50%; transform: translate(-50%, -50%);
            font-size: 20px; color: #ff6b81; font-weight: bold;
            opacity: 0; transition: 0.3s; pointer-events: none;
            white-space: nowrap; text-shadow: 1px 1px #fff;
        }
        
        /* å¼•å¯¼é¡µ */
        #start-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 238, 242, 0.95);
            display: flex; flex-direction: column; justify-content: center;
            align-items: center; z-index: 100;
        }
        .start-btn {
            padding: 15px 40px; font-size: 20px; background: #ff85a1;
            color: white; border: none; border-radius: 30px;
            cursor: pointer; box-shadow: 0 4px 15px rgba(255, 133, 161, 0.4);
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse { 0% {transform: scale(1);} 50% {transform: scale(1.1);} 100% {transform: scale(1);} }
        
        /* æ¸¸æˆç»“æŸ */
        #game-over {
            display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            text-align: center; z-index: 101; background: white; padding: 30px;
            border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); width: 80%;
        }
    </style>
</head>
<body>

<div id="game-container">
    <canvas id="gameCanvas"></canvas>
    <div id="ui-layer">
        <div class="score-box">å¿ƒåŠ¨å€¼: <span id="scoreVal">0</span></div>
        <div id="message-popup">å™œå™œæœ€æ£’ï¼</div>
    </div>

    <!-- åˆå§‹ç•Œé¢ -->
    <div id="start-screen">
        <h1 style="color: #ff4757; margin-bottom: 10px;">å™œå™œå¤§å†’é™©</h1>
        <p style="color: #666; width: 80%; text-align: center;">æ‹–åŠ¨ä¸‹æ–¹å¤´åƒï¼Œå¸®<b>å™œå™œ</b>æ¥ä½å¿«ä¹ï¼Œèº²å¼€çƒ¦æ¼ï¼</p>
        <div style="font-size: 50px; margin: 20px;">ğŸ±</div>
        <button class="start-btn" onclick="startGame()">å¼€å§‹ä¼ é€’å¿«ä¹</button>
    </div>

    <!-- ç»“æŸç•Œé¢ -->
    <div id="game-over">
        <h2 id="over-title">æŒ‘æˆ˜ç»“æŸ</h2>
        <p id="over-msg"></p>
        <button class="start-btn" onclick="location.reload()" style="animation:none;">é‡æ–°å¼€å§‹</button>
    </div>
</div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const scoreVal = document.getElementById('scoreVal');
    const msgPopup = document.getElementById('message-popup');
    
    let score = 0;
    let gameActive = false;
    let items = [];
    let player = { x: 0, y: 0, w: 70, h: 70, icon: 'ğŸ±' };
    let speedMult = 1;
    let particles = [];

    const sweetTalk = ["å™œå™œç¾æäº†ï¼", "æƒ³ä¸ºä½ æ‘˜æ˜Ÿæ˜Ÿ", "å¿«å»å–å¥¶èŒ¶ğŸ¥¤", "ä»Šå¤©ä¹Ÿè¦å¼€å¿ƒï¼", "æŠ±æŠ±å™œå™œ", "ä½ æ˜¯æˆ‘çš„å°ç¡®å¹¸"];
    const catchItems = [
        { icon: 'â¤ï¸', value: 10, type: 'good' },
        { icon: 'ğŸ°', value: 15, type: 'good' },
        { icon: 'ğŸ§‹', value: 20, type: 'good' },
        { icon: 'ğŸ›ï¸', value: 25, type: 'good' },
        { icon: 'ğŸ', value: 50, type: 'good' }
    ];
    const avoidItems = [
        { icon: 'ğŸ’£', value: -20, type: 'bad' },
        { icon: 'â›ˆï¸', value: -10, type: 'bad' },
        { icon: 'ğŸ¦Ÿ', value: -5, type: 'bad' },
        { icon: 'ğŸ’¼', value: -15, type: 'bad' }
    ];

    function initCanvas() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        player.x = canvas.width / 2 - player.w / 2;
        player.y = canvas.height - 120;
    }

    // ç›‘å¬è¾“å…¥
    function handleInput(e) {
        let clientX = e.touches ? e.touches[0].clientX : e.clientX;
        player.x = clientX - player.w / 2;
        // è¾¹ç•Œé™åˆ¶
        if (player.x < 0) player.x = 0;
        if (player.x > canvas.width - player.w) player.x = canvas.width - player.w;
    }

    window.addEventListener('mousemove', handleInput);
    window.addEventListener('touchmove', handleInput);
    window.addEventListener('resize', initCanvas);

    function startGame() {
        document.getElementById('start-screen').style.display = 'none';
        initCanvas();
        score = 0;
        items = [];
        gameActive = true;
        speedMult = 1;
        requestAnimationFrame(update);
        spawnItem();
    }

    function spawnItem() {
        if (!gameActive) return;
        
        let isGood = Math.random() > 0.35;
        let pool = isGood ? catchItems : avoidItems;
        let template = pool[Math.floor(Math.random() * pool.length)];
        
        items.push({
            x: Math.random() * (canvas.width - 40),
            y: -50,
            vy: (Math.random() * 2 + 2) * speedMult,
            ...template
        });

        setTimeout(spawnItem, 1000 / (speedMult * 0.8));
    }

    function showPopup(txt) {
        msgPopup.innerText = txt;
        msgPopup.style.opacity = 1;
        setTimeout(() => msgPopup.style.opacity = 0, 800);
    }

    function update() {
        if (!gameActive) return;
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // ç»˜åˆ¶ç©å®¶ (æ’¸å™œå§)
        ctx.font = '60px Arial';
        ctx.textAlign = 'left';
        ctx.fillText(player.icon, player.x, player.y + 50);

        // ç»˜åˆ¶å¹¶æ›´æ–°ç‰©å“
        for (let i = items.length - 1; i >= 0; i--) {
            let it = items[i];
            it.y += it.vy;
            ctx.font = '40px Arial';
            ctx.fillText(it.icon, it.x, it.y);

            // ç¢°æ’æ£€æµ‹
            if (it.y > player.y - 40 && it.y < player.y + 20 &&
                it.x > player.x - 30 && it.x < player.x + player.w) {
                
                score += it.value;
                scoreVal.innerText = score;
                
                if (it.type === 'good') {
                    showPopup(sweetTalk[Math.floor(Math.random() * sweetTalk.length)]);
                    // ç²’å­æ•ˆæœ
                    for(let j=0; j<5; j++) createParticle(it.x, it.y, '#ff4757');
                } else {
                    showPopup('åˆ«è®©åå¿ƒæƒ…ç¢°åˆ°ï¼');
                    for(let j=0; j<5; j++) createParticle(it.x, it.y, '#57606f');
                }
                
                items.splice(i, 1);
                speedMult = 1 + (score / 500); // éš¾åº¦éšç§¯åˆ†æå‡
                continue;
            }

            // ç§»é™¤å‡ºå±ç‰©å“
            if (it.y > canvas.height) items.splice(i, 1);
        }

        updateParticles();
        
        if (score < -50) endGame(); // è´Ÿåˆ†é—¨æ§›
        else requestAnimationFrame(update);
    }

    // ç²’å­ç³»ç»Ÿ
    function createParticle(x, y, color) {
        particles.push({
            x, y, 
            vx: (Math.random()-0.5)*10, 
            vy: (Math.random()-0.5)*10, 
            life: 1.0, 
            color
        });
    }

    function updateParticles() {
        for(let i = particles.length-1; i>=0; i--) {
            let p = particles[i];
            p.x += p.vx; p.y += p.vy;
            p.life -= 0.05;
            if(p.life <= 0) {
                particles.splice(i, 1);
            } else {
                ctx.globalAlpha = p.life;
                ctx.fillStyle = p.color;
                ctx.beginPath();
                ctx.arc(p.x, p.y, 4, 0, Math.PI*2);
                ctx.fill();
            }
        }
        ctx.globalAlpha = 1.0;
    }

    function endGame() {
        gameActive = false;
        document.getElementById('game-over').style.display = 'block';
        document.getElementById('over-msg').innerText = `å™œå™œè·å¾—äº† ${score} ç‚¹å¿«ä¹å€¼ï¼è™½ç„¶ç¢°åˆ°äº†ä¸€ç‚¹å°éº»çƒ¦ï¼Œä½†ä¾ç„¶æ˜¯æœ€æ£’çš„å™œå™œï¼â¤ï¸`;
    }
</script>
</body>
</html>
